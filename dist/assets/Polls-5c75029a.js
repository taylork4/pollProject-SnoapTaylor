import{d as de,r as S,a as p,b as O,s as W,t as X,c as s,u as o,w as C,v as Y,e as a,F as w,f as U,i as D,g as u,h as A,j as b,k as pe,l as Z,o as l,m as _,n as ee,p as ve,q as he,J as Q,x as fe,y as F}from"./index-4f959544.js";import{_ as _e}from"./_plugin-vue_export-helper-c27b6911.js";const B=G=>(ve("data-v-763895c0"),G=G(),he(),G),ye={key:0},ge=B(()=>a("option",{value:""},"Filter by Genre",-1)),ke=["value"],me={key:1},xe=B(()=>a("h1",{style:{"line-height":"100%"}}," Sign Up or Login to create and answer polls! ",-1)),Ce=[xe],we={key:2},be={class:"header"},Pe={key:0},Se={key:1},Ue=B(()=>a("option",{value:""},"Select a Genre",-1)),Ve=["value"],Re={key:0},Ae={key:1},Qe={key:2,style:{"margin-top":"20px"}},Fe={key:3,style:{"margin-top":"20px"}},Be={key:4,class:"header"},Ge={key:0},Ne=B(()=>a("h1",{style:{"line-height":"100%"}}," Click the + button to create a poll! ",-1)),Te=B(()=>a("h2",null,"Refresh to see updates!",-1)),Ie=[Ne,Te],Le={key:3},qe={key:0},De={class:"pollQuestion"},Ee=["onClick"],Me={key:1},Je=["onClick"],$e={key:1,style:{display:"inline-block","margin-left":"10px"}},je={key:4},ze={key:0},He={key:0,class:"pollQuestion"},Ke=["onClick"],Oe={key:1},We=["onClick"],Xe={key:1,style:{display:"inline-block","margin-left":"10px"}},Ye=de({__name:"Polls",setup(G){const te=new Date().toLocaleString(),oe=S(b,"polls/public");let m={pollQuestion:"",pollChoices:["","","",""],votes:[0,0,0,0],date:"",genre:""};pe().query.email;const V=p(""),I=p("");let R="",x=p(""),r=p(["","","",""]);const E=["Music","Pop Culture","Food","Sports","Random"];let h=p(""),g=p(""),v=p(1),f=p(1),y=p(1),M=0,L=p([]),q=p([]);const P=p(!0);O.onAuthStateChanged(function(t){t?(P.value=!0,V.value=t.uid):(P.value=!1,V.value="")});function se(t){L.value=t.favorited,q.value=t.responded}async function le(t){const n=S(b,"profile",t),e=await Q(n);if(e.exists()){const c=e.data();c?se(c):console.log("No data found in document!")}else console.log("No such document!")}async function ne(){await new Promise(t=>{Z(I,(n,e)=>{R=n,t()}),Z(V,(n,e)=>{t()})}),le(R)}function ae(t){t?(V.value=t.uid,t.uid,I.value=t.email||""):(V.value="",I.value="")}async function ie(t,n){try{const c=(await fe(W(t,"allPolls"),n)).id;ue(c),X(J).then(i=>{const d=i.docs.map(k=>({...k.data(),id:k.id}));return Promise.all(d)}).then(i=>{for(let d=0;d<i.length;d++)N.value[d]=i[d];M=i.length}).catch(i=>{console.log(i.message)}),console.log("Successful addition!")}catch(e){console.log(`I got an error! ${e}`)}}async function ue(t){const n=S(b,"profile",R),e=await Q(n);if(e.exists()){const c=e.data();c&&(c.created.push(t),await F(n,c))}}const J=W(b,"polls/public/allPolls");let N=p([]);X(J).then(t=>{const n=t.docs.map(e=>({...e.data(),id:e.id}));return Promise.all(n)}).then(t=>{console.log(t);for(let n=0;n<t.length;n++)N.value[n]=t[n];M=t.length}).catch(t=>{console.log(t.message)}),O.onAuthStateChanged(ae),ne();function $(){v.value=3-v.value,x.value="",r.value=["","","",""],m.pollQuestion="",m.pollChoices=["","","",""],f.value=1,y.value=1,g.value=""}function j(){f.value=3-f.value,f.value==1&&(r.value[2]=""),y.value==2&&f.value==1&&(r.value[2]=r.value[3],r.value[3]="",f.value=2,y.value=1)}function z(){y.value=3-y.value,y.value==1&&(r.value[3]="")}async function re(){v.value=3-v.value,f.value=1,y.value=1,m.date=te,m.pollQuestion=x.value;for(let t=0;t<r.value.length;t++)m.pollChoices[t]=r.value[t];m.genre=g.value,await Promise.all([ie(oe,m)])}function ce(){window.scrollTo({top:0,behavior:"smooth"})}async function H(t,n){const e=S(b,"polls/public/allPolls",t),c=S(b,"profile",R),i=await Q(e),d=await Q(c);if(i.exists()&&d.exists()){const k=i.data(),T=d.data();k&&T&&(T.responded.includes(t)||(k.votes[n]++,T.responded.push(t),await F(e,k),await F(c,T)))}}async function K(t,n){const e=S(b,"profile",R),c=await Q(e);if(c.exists()){const i=c.data();i&&(i.favorited.includes(t)?(i.favorited=i.favorited.filter(d=>d!==t),await F(e,i)):(i.favorited.push(t),await F(e,i)))}}return(t,n)=>(l(),s(w,null,[o(v)==1?(l(),s("div",ye,[C(a("select",{style:{"margin-bottom":"20px"},"onUpdate:modelValue":n[0]||(n[0]=e=>D(h)?h.value=e:h=e),id:"genre"},[ge,(l(),s(w,null,U(E,e=>a("option",{value:e},_(e),9,ke)),64))],512),[[Y,o(h)]])])):u("",!0),P.value?u("",!0):(l(),s("span",me,Ce)),P.value?(l(),s("span",we,[a("div",be,[o(v)==1?(l(),s("span",Pe,[a("button",{onClick:$}," + ")])):u("",!0),o(v)==2?(l(),s("span",Se,[a("button",{onClick:$}," Cancel "),a("h1",null,[C(a("input",{type:"text",placeholder:"Poll Question","onUpdate:modelValue":n[1]||(n[1]=e=>D(x)?x.value=e:x=e),class:"question"},null,512),[[A,o(x)]])]),a("div",null,[C(a("select",{"onUpdate:modelValue":n[2]||(n[2]=e=>D(g)?g.value=e:g=e),id:"genre"},[Ue,(l(),s(w,null,U(E,e=>a("option",{value:e},_(e),9,Ve)),64))],512),[[Y,o(g)]])]),a("h1",null,[C(a("input",{type:"text",placeholder:"Poll Answer","onUpdate:modelValue":n[3]||(n[3]=e=>o(r)[0]=e),class:"answer"},null,512),[[A,o(r)[0]]])]),a("h1",null,[C(a("input",{type:"text",placeholder:"Poll Answer","onUpdate:modelValue":n[4]||(n[4]=e=>o(r)[1]=e),class:"answer"},null,512),[[A,o(r)[1]]])]),o(f)==1?(l(),s("span",Re,[a("button",{onClick:j}," + ")])):u("",!0),o(f)==2?(l(),s("span",Ae,[a("div",null,[C(a("input",{style:{"margin-right":"20px","margin-left":"66px"},type:"text",placeholder:"Poll Answer","onUpdate:modelValue":n[5]||(n[5]=e=>o(r)[2]=e),class:"answer"},null,512),[[A,o(r)[2]]]),a("button",{onClick:j}," - ")])])):u("",!0),o(y)==1&&o(f)==2?(l(),s("span",Qe,[a("button",{style:{"margin-top":"20px"},onClick:z}," + ")])):u("",!0),o(y)==2?(l(),s("span",Fe,[a("div",null,[C(a("input",{style:{"margin-right":"20px","margin-left":"66px"},type:"text",placeholder:"Poll Answer","onUpdate:modelValue":n[6]||(n[6]=e=>o(r)[3]=e),class:"answer"},null,512),[[A,o(r)[3]]]),a("button",{style:{"margin-top":"20px"},onClick:z}," - ")])])):u("",!0),o(r)[0]===""||o(r)[1]===""||o(x)===""||o(g)==="Select a genre"||o(g)===""?u("",!0):(l(),s("div",Be,[a("button",{style:{"margin-top":"20px"},onClick:re}," Post ")]))])):u("",!0)]),o(v)==1?(l(),s("div",Ge,Ie)):u("",!0)])):u("",!0),o(v)==1&&(o(h)==="Filter by Genre"||o(h)==="")?(l(),s("div",Le,[(l(!0),s(w,null,U(o(N),(e,c)=>(l(),s("div",{key:c},["pollQuestion"in e&&!o(q).includes(e.id)?(l(),s("span",qe,[a("h2",De,[P.value?(l(),s("span",{key:0,style:{top:"-5px",right:"5px"},class:"star",onClick:i=>K(e.id)},_(o(L).includes(e.id)?"★":"☆"),9,Ee)):u("",!0),ee(" "+_(e.pollQuestion),1)])])):u("",!0),"pollChoices"in e&&"votes"in e&&!o(q).includes(e.id)?(l(),s("span",Me,[(l(!0),s(w,null,U(e.pollChoices,(i,d)=>(l(),s("div",null,[i!==""?(l(),s("button",{key:0,onClick:k=>H(e.id,d),class:"pollButtons"},_(i),9,Je)):u("",!0),i!==""&&Array.isArray(e.votes)?(l(),s("p",$e,_((100*(e.votes[d]/(e.votes[0]+e.votes[1]+e.votes[2]+e.votes[3]))).toFixed(2))+"%",1)):u("",!0)]))),256))])):u("",!0)]))),128))])):u("",!0),o(v)==1&&!(o(h)==="Filter by Genre"||o(h)==="")?(l(),s("div",je,[(l(!0),s(w,null,U(o(N),(e,c)=>(l(),s("div",{key:c},["pollQuestion"in e&&"genre"in e?(l(),s("span",ze,[e.genre===o(h)?(l(),s("h2",He,[P.value?(l(),s("span",{key:0,style:{top:"-5px",right:"5px"},class:"star",onClick:i=>K(e.id)},_(o(L).includes(e.id)?"★":"☆"),9,Ke)):u("",!0),ee(" "+_(e.pollQuestion),1)])):u("",!0)])):u("",!0),"pollChoices"in e&&"genre"in e&&"votes"in e?(l(),s("span",Oe,[e.genre===o(h)?(l(!0),s(w,{key:0},U(e.pollChoices,(i,d)=>(l(),s("div",null,[i!==""?(l(),s("button",{key:0,onClick:k=>H(e.id,d),class:"pollButtons"},_(i),9,We)):u("",!0),i!==""&&Array.isArray(e.votes)?(l(),s("p",Xe,_((100*(e.votes[d]/(e.votes[0]+e.votes[1]+e.votes[2]+e.votes[3]))).toFixed(2))+"%",1)):u("",!0)]))),256)):u("",!0)])):u("",!0)]))),128))])):u("",!0),a("div",null,[o(v)==1?(l(),s("button",{key:0,onClick:ce,class:"back-to-top"},"Back to top")):u("",!0)])],64))}});const st=_e(Ye,[["__scopeId","data-v-763895c0"]]);export{st as default};
